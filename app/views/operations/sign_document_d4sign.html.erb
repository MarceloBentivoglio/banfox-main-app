<div class="wrapper-page-wo-subnavbar">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <%= render partial: "shared/headers/header_section_w_opt_btn", locals: {
          title: "Contrato da operação",
          optional_button: "",
          } %>
        <div id='signature-div' data-signature-key="<%= @signature_key %>" data-partner-email="<%= @seller.email_partner %>" data-document-uuid="<%= @document_uuid %>" data-redirection-url="<%= @redirection_url %>"></div>
        <%= link_to "Ver status da minha operação", opened_installments_path, class: "btn-rounded blue button text-center", id: "opened-installments-button" %>
      </div>
    </div>
  </div>
</div>
<script>
  window.onload = function() {
    key_signer = document.getElementById("signature-div").getAttribute("data-signature-key");
    email = document.getElementById("signature-div").getAttribute("data-partner-email");
    redirection_url = document.getElementById("signature-div").getAttribute("data-redirection-url");
    doc_uuid = document.getElementById("signature-div").getAttribute("data-document-uuid");
    d4sign.configure({
      container: "signature-div",
      key: doc_uuid,
      protocol: "https",
      host: "secure.d4sign.com.br/embed/viewblob",
      signer: {
        email: email,
        key_signer: key_signer
      },
      width: '1025',
      height: '400',
      callback: function(event) {
        if (event.data === "signed") {
          //TODO call event to add a status = signed to signer_signature_key
          window.location.replace(redirection_url);
        }
      }
    });
  }
</script>
